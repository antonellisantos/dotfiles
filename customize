#!/bin/bash

# Inspired by https://github.com/thiagommedeiros/dotfiles

GREEN='\033[0;32m'
RED="\033[0;31m"
NC="\033[0m"

function p_red() {
  printf "\n${RED}$1${NC}\n"
}

function p_green() {
  printf "\n${GREEN}$1${NC}\n"
}

function customize() {
  p_red "[CUSTOMIZE] Oh-my-zsh"
  TEST_CURRENT_SHELL=$(expr "$SHELL" : '.*/\(.*\)')
  if [ "$TEST_CURRENT_SHELL" != "zsh" ]; then
    if hash chsh >/dev/null 2>&1; then
      chsh -s $(grep /zsh$ /etc/shells | tail -1)
    fi
  fi
  sed -i "s/USER/${USER}/" zsh/.zshrc
  cp zsh/.zshrc ~/
  cp zsh/materialshell-oceanic.zsh-theme ~/.oh-my-zsh/themes
  p_green "[CUSTOMIZE] Oh-my-zsh: DONE\!"

  p_red "[CUSTOMIZE] Terminator"
  mkdir ~/.config/terminator/
  cp terminator/config ~/.config/terminator/config
  p_green "[CUSTOMIZE] Terminator: DONE\!"

  p_red "[CUSTOMIZE] Git"
  cp git/.gitconfig ~/
  if [ $# -ge 2 ] && [ ! -z "$1" ] && [ ! -z "$2" ]; then
    ssh-keygen -t rsa -b 4096 -C "$1" -N "$2" -f ~/.ssh/id_rsa -q
    ssh-add ~/.ssh/id_rsa.pub
    p_red "[CUSTOMIZE] Git: Now you've to copy the text in the openned file and paste in your Github\!"
    if ! subl_loc="$(type -p "$subl")" || [ -z "$subl_loc" ]; then
      gedit ~/.ssh/id_rsa
    else
      subl ~/.ssh/id_rsa
    fi
  fi
  p_green "[CUSTOMIZE] Git: DONE\!"

  p_red "[CUSTOMIZE] NGINX"
  sed -i "s/USER/${USER}/" nginx/NGINX
  mkdir ~/Desktop/NGINX/
  sudo cp nginx/NGINX /etc/nginx/sites-enabled/NGINX
  sudo service nginx stop
  sudo service nginx start
  p_green "[CUSTOMIZE] NGINX: DONE\!"

  p_red "[CUSTOMIZE] Sublime Text 3"
  cp st3/Package\ Control.sublime-settings ~/.config/sublime-text-3/Packages/User/Package\ Control.sublime-settings
  cp st3/Base\ File.sublime-settings ~/.config/sublime-text-3/Packages/User/Base\ File.sublime-settings
  cp st3/Preferences.sublime-settings ~/.config/sublime-text-3/Packages/User/Preferences.sublime-settings
  cp st3/Emmet.sublime-settings ~/.config/sublime-text-3/Packages/User/Emmet.sublime-settings
  mv st3/Material\ Theme.sublime-package ~/.config/sublime-text-3/Installed\ Packages/
  cd ~/.config/sublime-text-3/Installed\ Packages/
  wget https://packagecontrol.io/Package%20Control.sublime-package
  cd
  p_green "[CUSTOMIZE] Sublime Text 3: DONE\!"

  p_red "[CUSTOMIZE] Desktop Folder"
  mv Área\ de\ Trabalho/ Desktop/
  sed -i "s/Área de Trabalho/Desktop/" ~/.config/user-dirs.dirs
  p_green "[CUSTOMIZE] Desktop Folder: DONE\!"
}

read -p "You are logged as ${USER}, do you wanna continue? [y/n] " cont
if [ "$cont" = "y" ]; then
  read -p ">  Do you wanna generete a SSH Key to GitHub? [y/n] " gen
  if [ "$gen" = "y" ]; then
    read -p ">    [SSH Key] E-mail: " email
    read -s -p ">    [SSH Key] Passphrase: " pass
    echo
    customize $email $pass
  else
    customize
  fi
fi
